name: Check

on:
  push:
    branches:
      - persistenceCore/action

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: SBT action test
        id: sbt
        uses: lokkju/github-action-sbt@11-1.3.0-2.12.10
        with:
          commands: dist
      - uses: actions/upload-artifact@v2
        with:
          name: client.zip
          path: target/universal/persistenceclient-1.0.zip

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@v2
        with:
          name: client.zip
          path: target/universal/persistenceclient-1.0.zip
      - name: Operations
        uses: alinz/ssh-scp-action@master
        with:
          key: ${{ secrets.EXPLORER_DEVELOP_SSH_KEY }}
          host: ${{ secrets.EXPLORER_DEVELOP_HOST }}
          port: 22
          user: ${{ secrets.EXPLORER_DEVELOP_USERNAME }}
          ssh_before: |
            rm -r explorer.zip
          scp: |
           target/universal/persistenceclient-1.0.zip ${{ secrets.EXPLORER_DEVELOP_USERNAME }}@${{ secrets.EXPLORER_DEVELOP_HOST }}:~/explorer.zip
          # then run these commands
          ssh_after: |
            ${{ secrets.EXPLORER_DEVELOP_SCRIPT }}


