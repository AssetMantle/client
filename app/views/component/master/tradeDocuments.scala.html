@import controllers.actions.LoginState
@import models.masterTransaction.NegotiationFile
@import models.masterTransaction.AssetFile
@import models.master.Negotiation
@import views.html.base._
@import models.docusign.Envelope

@(negotiation: Negotiation, assetFiles: Seq[AssetFile], negotiationFiles: Seq[NegotiationFile],negotiationEnvelopeList:Seq[Envelope])(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, flash: Flash, loginState: LoginState = null)

@negotiation.status match {
    case constants.Status.Negotiation.BUYER_ACCEPTED_ALL_NEGOTIATION_TERMS => {
        <div id='@Seq("UPLOAD", "NEGOTIATION", constants.File.Negotiation.CONTRACT).mkString("_")'>
        @commonModalButton(Seq("UPLOAD", constants.File.Negotiation.CONTRACT).mkString("_"), routes.javascript.FileController.uploadNegotiationForm,  'parameters -> s"'${constants.File.Negotiation.CONTRACT}','${negotiation.id}'")
        </div>
        @negotiationFiles.find(_.documentType== constants.File.Negotiation.CONTRACT) match {
            case Some(document) => {
                @component.master.commonDocumentViewer(document) {
                    @routes.FileController.tradingFile(negotiation.id, document.fileName, document.documentType)
                } {
                    <a href="@routes.FileController.tradingFile(negotiation.id, document.fileName, document.documentType)">@Messages(document.documentType)</a>
                } {
                    @negotiationEnvelopeList.find(_.documentType == document.documentType) match {
                        case Some(docusignEnvelope)=> {
                            <span>@constants.View.CONTRACT_SIGNATURE_PENDING</span>
                        }
                        case None=> {
                            <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateNegotiationForm('@document.documentType', '@negotiation.id'))">@Messages(constants.View.UPDATE) @Messages(document.documentType)</button>
                             @commonFormButton(constants.Form.ADD_CONTRACT, 'parameters -> s"'${negotiation.id}'")
                            }
                        }
                    }
                <script>hideElement('@Seq("UPLOAD", "NEGOTIATION", constants.File.Negotiation.CONTRACT).mkString("_")')</script>
                <td><li><a href="@controllers.routes.ViewController.tradeRoom(negotiation.id)">@Messages(constants.View.SUBMIT)</a></li></td>
            }
            case None=> {}
                }
          }
    case constants.Status.Negotiation.CONTRACT_SIGNED | constants.Status.Negotiation.BUYER_CONFIRMED_SELLER_PENDING | constants.Status.Negotiation.SELLER_CONFIRMED_BUYER_PENDING | constants.Status.Negotiation.BOTH_PARTIES_CONFIRMED=>{
        <div>
        @Messages(constants.View.ASSET_DOCUMENTS):
        @negotiation.documentList.assetDocuments.map { assetDocuemntType =>
            <div id='@Seq("UPLOAD", "ASSET", assetDocuemntType).mkString("_")'>
            @commonModalButton(Seq("UPLOAD", assetDocuemntType).mkString("_"), routes.javascript.FileController.uploadAssetForm, 'parameters -> s"'${assetDocuemntType}','${negotiation.id}'")
            </div>
        }
        @assetFiles.filter(assetFile => negotiation.documentList.assetDocuments.contains(assetFile.documentType)).map { assetFile =>
            @component.master.commonDocumentViewer(assetFile) {
                @routes.FileController.tradingFile(negotiation.id, assetFile.fileName, assetFile.documentType)
            } {
                <a href="@routes.FileController.tradingFile(assetFile.id, assetFile.fileName, assetFile.documentType)">@Messages(assetFile.documentType)</a>
            } {
                <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateAssetForm('@assetFile.documentType', '@negotiation.id'))">@Messages(constants.View.UPDATE)@Messages(assetFile.documentType)</button>
                @assetFile.documentType match {
                    case constants.File.Asset.BILL_OF_LADING => {
                        @commonFormButton(constants.Form.ADD_BILL_OF_LADING, 'parameters -> s"'${negotiation.id}'")
                    }
                    case _ => {}
                }
                <script>hideElement('UPLOAD_ASSET_@assetFile.documentType')</script>
            }
        }

        @Messages(constants.View.NEGOTIATION_DOCUMENTS):
        @negotiation.documentList.negotiationDocuments.filter(negotiationDocumentType => constants.File.NEGOTIATION_DOCUMENTS.contains(negotiationDocumentType)).map { negotiationDocumentType =>
            <div id='@Seq("UPLOAD_NEGOTIATION", negotiationDocumentType).mkString("_")'>
            @commonModalButton(Seq("UPLOAD", negotiationDocumentType).mkString("_"), routes.javascript.FileController.uploadNegotiationForm, 'parameters -> s"'${negotiationDocumentType}','${negotiation.id}'")
            </div>
        }

        @negotiationFiles.filterNot(_.documentType == constants.File.Negotiation.CONTRACT).map { negotiationFile =>
            @component.master.commonDocumentViewer(negotiationFile) {
                @routes.FileController.tradingFile(negotiation.id, negotiationFile.fileName, negotiationFile.documentType)
            } {
                <a href="@routes.FileController.tradingFile(negotiation.id, negotiationFile.fileName, negotiationFile.documentType)">@Messages(negotiationFile.documentType)</a>
            } {
                <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateNegotiationForm('@negotiationFile.documentType', '@negotiation.id'))">@Messages(constants.View.UPDATE) @Messages(negotiationFile.documentType)</button>
                @negotiationFile.documentType match {
                    case constants.File.Negotiation.INVOICE => {
                        @commonFormButton(constants.Form.ADD_INVOICE, 'parameters -> s"'${negotiation.id}'")
                    }
                    case _ => {}
                }
                <script>hideElement('UPLOAD_NEGOTIATION_@negotiationFile.documentType')</script>
            }
        }
        <td><li><a href="@controllers.routes.ViewController.tradeRoom(negotiation.id)">@Messages(constants.View.SUBMIT)</a></li></td>
        </div>
    }
    case _=>{}
}



