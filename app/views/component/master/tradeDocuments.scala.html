@import controllers.actions.LoginState
@import views.html.base._
@import models.masterTransaction.NegotiationFile
@import models.masterTransaction.AssetFile
@import models.master.Negotiation
@import models.masterTransaction.DocusignEnvelope

@(negotiation: Negotiation,assetFiles: Seq[AssetFile],negotiationFiles: Seq[NegotiationFile],docusignEnvelopeList:Seq[DocusignEnvelope])(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, flash: Flash, loginState: LoginState = null)

    @negotiation.status match {
        case constants.Status.Negotiation.BUYER_ACCEPTED_ALL_NEGOTIATION_TERMS =>{

            <div id='@Seq("UPLOAD_", constants.File.CONTRACT).mkString("")'>
            @commonModalButton(Seq("UPLOAD_", constants.File.CONTRACT).mkString(""), routes.javascript.FileController.uploadTraderNegotiationForm,  'parameters -> s"'${constants.File.CONTRACT}','${negotiation.id}'")
            </div>
            @negotiationFiles.find(_.documentType== constants.File.CONTRACT) match {
                case Some(document) => {
                    @component.master.commonDocumentViewer(document) {
                        @routes.FileController.tradingFile(negotiation.id, document.fileName, document.documentType)
                    } {
                        <a href="@routes.FileController.tradingFile(negotiation.id, document.fileName, document.documentType)">@Messages(document.documentType)</a>
                    } {
                       @if(negotiation.status== constants.Status.Negotiation.BUYER_ACCEPTED_ALL_NEGOTIATION_TERMS){
                           <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateTraderNegotiationForm('@document.documentType', '@negotiation.id'))">@Messages(constants.Form.UPDATE) @Messages(document.documentType)</button>
                           @commonFormButton(constants.Form.CONTRACT_CONTENT, 'parameters -> s"'${negotiation.id}'")
                       }
                       }
                    <script>hideElement('@Seq("UPLOAD_", constants.File.CONTRACT).mkString("")')</script>
                    <td><li><a href="@controllers.routes.ViewController.tradeRoom(negotiation.id)">@Messages(constants.Form.SUBMIT)</a></li></td>
                }
                case None=> {}
                    }
                }
        case constants.Status.Negotiation.BUYER_SIGNED_CONTRACT | constants.Status.Negotiation.BUYER_CONFIRMED_PRICE_SELLER_PENDING | constants.Status.Negotiation.SELLER_CONFIRMED_PRICE_BUYER_PENDING | constants.Status.Negotiation.BOTH_PARTY_CONFIRMED_PRICE | constants.Status.Negotiation.TRADE_COMPLETED=>{

        @Messages(constants.View.ASSET_DOCUMENTS):
        @negotiation.documentList.assetDocuments.map{assetDocuemntType=>
            <div id='@Seq("UPLOAD_ASSET_", assetDocuemntType).mkString("")'>
            @commonModalButton(Seq("UPLOAD_", assetDocuemntType).mkString(""), routes.javascript.FileController.uploadTraderAssetForm,  'parameters -> s"'${assetDocuemntType}','${negotiation.id}'")
            </div>
        }
        @assetFiles.filter(assetFile=>negotiation.documentList.assetDocuments.contains(assetFile.documentType)).map{assetFile=>
            @component.master.commonDocumentViewer(assetFile) {
                @routes.FileController.tradingFile(negotiation.id, assetFile.fileName, assetFile.documentType)
            } {
                <a href="@routes.FileController.tradingFile(assetFile.id, assetFile.fileName, assetFile.documentType)">@Messages(assetFile.documentType)</a>
            } {
                <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateTraderNegotiationForm('@assetFile.documentType', '@assetFile.id'))">@Messages(constants.Form.UPDATE)@Messages(assetFile.documentType)</button>
                @assetFile.documentType match{
                    case constants.File.OBL=>{@commonFormButton(constants.Form.OBL_CONTENT, 'parameters -> s"'${negotiation.id}'")}
                    case _=>{}
                }
                <script>hideElement('UPLOAD_ASSET_@assetFile.documentType')</script>
            }
        }

        @Messages(constants.View.NEGOTIATION_DOCUMENTS):
        @negotiation.documentList.negotiationDocuments.filter(negotiationDocumentType=>constants.File.TRADER_NEGOTIATION_DOCUMENTS.contains(negotiationDocumentType)).map{negotiationDocumentType=>
            <div id='@Seq("UPLOAD_NEGOTIATION_", negotiationDocumentType).mkString("")'>
            @commonModalButton(Seq("UPLOAD_", negotiationDocumentType).mkString(""), routes.javascript.FileController.uploadTraderNegotiationForm,  'parameters -> s"'${negotiationDocumentType}','${negotiation.id}'")
            </div>
        }

        @negotiationFiles.filter(_.documentType == constants.File.CONTRACT).map{negotiationFile=>
            @component.master.commonDocumentViewer(negotiationFile) {
                @routes.FileController.tradingFile(negotiation.id, negotiationFile.fileName, negotiationFile.documentType)
            } {
                <a href="@routes.FileController.tradingFile(negotiation.id, negotiationFile.fileName, negotiationFile.documentType)">@Messages(negotiationFile.documentType)</a>
            } {
                <button type="button" class="cmuk-button cmuk-button-primary" onclick="getForm(jsRoutes.controllers.FileController.updateTraderNegotiationForm('@negotiationFile.documentType', '@negotiation.id'))">@Messages(constants.Form.UPDATE) @Messages(negotiationFile.documentType)</button>
                @negotiationFile.documentType match{
                    case constants.File.INVOICE=>{@commonFormButton(constants.Form.INVOICE_CONTENT, 'parameters -> s"'${negotiation.id}'")}
                    case _=>{}
                }
                <script>hideElement('UPLOAD_NEGOTIATION_@negotiationFile.documentType')</script>
            }
        }
            <td><li><a href="@controllers.routes.ViewController.tradeRoom(negotiation.id)">@Messages(constants.Form.SUBMIT)</a></li></td>
        }
        case _=>{}
    }



