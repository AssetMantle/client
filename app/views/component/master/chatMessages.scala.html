@import controllers.actions.LoginState
@import views.html.base._
@import views.companion.master.SendChat
@import models.masterTransaction.Chat
@import models.masterTransaction.ChatReceive
@import views.html.component.master.sendChat

@(chats: Seq[Chat], readChats: Seq[ChatReceive], chatWindowID: String)(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, flash: Flash, configuration: play.api.Configuration, loginState: LoginState)

    <div class="chatInnerContainer">
    <div class = "chatMessage loadMoreButton"><a onclick="loadMoreChats('@chatWindowID')" >@Messages(constants.Form.LOAD_MORE_NOTIFICATIONS)</a></div>
    @for(chat <- chats.reverse) {
        @if(chat.fromAccountID == loginState.username) {
            <li class="sender chatMessage">
                <div class="you" onclick="replyButton('@chat.id', '@chat.message', '@chat.fromAccountID')">
                    @chat.replyToID match {
                        case Some(replyToChatID) => {
                            <div class="messageContent cmuk-text-right replytoMessage">
                                <p id="@chat.replyToID@chat.id"></p>
                                <script>
                                 replyMessage(jsRoutes.controllers.TradeRoomController.replyToChat('@chatWindowID', '@replyToChatID'),'@chat.id')
                        </script>
                            </div>
                        }
                        case None => {}
                    }
                    <p>@chat.fromAccountID
                        : @chat.message</p>
                </div>
                <span class="chatName">@chat.fromAccountID.substring(0, 1)</span>
            </li>
        } else {
            @* unread bar for viewer logic here _.chatid == chatid, to account == loginstate, read at time ==nondefining, show unread messages.*@
            <li class="receiver chatMessage">
                <span class="chatName">@chat.fromAccountID.substring(0, 1)</span>
                <div class="patner" onclick="replyButton('@chat.id', '@chat.message', '@chat.fromAccountID')">
                    @chat.replyToID match {
                        case Some(replyToChatID) => {
                            <div class="messageContent cmuk-text-right replytoMessage">
                                <p id="@chat.replyToID@chat.id"></p>
                                <script>
                                 replyMessage(jsRoutes.controllers.TradeRoomController.replyToChat('@chatWindowID', '@replyToChatID'),'@chat.id')
                        </script>
                            </div>
                        }
                        case None => {}
                    }
                    <p>@chat.fromAccountID
                        : @chat.message</p>
                    @if(readChats.filter(x => x.chatID == chat.id && x.toAccountID == loginState.username).length == 0) {
                        <script>
                              unReadBar(@chats.filter(_.fromAccountID != loginState.username).length - @readChats.filter(_.toAccountID == loginState.username).length);
                      </script>
                    }
                </div>
            </li>
        }
    }
    </div>
