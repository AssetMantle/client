@import controllers.actions.LoginState
@import views.html.base._
@import views.companion.master.SendMessage
@import models.masterTransaction.Chat
@import models.masterTransaction.ChatReceive
@import views.html.component.master.sendMessage
@import views.html.component.master.chatMessages

@(sendMessageForm: Form[SendMessage.Data] = SendMessage.form, chats: Seq[Chat], readChats: Seq[ChatReceive], chatWindowID: String)(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, flash: Flash, configuration: play.api.Configuration, loginState: LoginState)
@if(chats.length > 0) {
    @if(readChats.filter(x => x.chatID == chats.head.id).filter(x => x.toAccountID == loginState.username).length == 0 && chats.head.fromAccountID != loginState.username) {
        <div onclick="markChatRead(jsRoutes.controllers.TradeRoomController.markChatAsRead('@chatWindowID'))" style="font-size: 12px;">
    }
}

<div id="chatMessages" class="chatMessages chat" title="You have chat with">
    <script>
            componentResource('chatMessages', jsRoutes.controllers.TradeRoomController.loadMoreChats('@chatWindowID', 0))
    </script>
</div>

<div>
@if(chats.length > 0) {
    <div style="font-size: 12px;">@Messages(constants.View.READ_BY) : @readChats.filter(_.chatID == chats.head.id).map(_.toAccountID).mkString</div>
}
</div>
<div class="chatform">
@sendMessage(sendMessageForm)
</div>
</div>
<script src="@routes.Assets.versioned("javascripts/chatRoom.js")" type="text/javascript"></script>
<script type="text/javascript">
        var chatCometMessage = function (event) {
            componentResource('chatMessages', jsRoutes.controllers.TradeRoomController.loadMoreChats('@chatWindowID', 0));
        }
</script>

<iframe class="hidden" src="@routes.TradeRoomController.sendMessageComet(chatWindowID)"></iframe>