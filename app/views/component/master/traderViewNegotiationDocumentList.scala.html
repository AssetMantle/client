@import controllers.actions.LoginState
@import views.html.base._
@import models.masterTransaction.NegotiationFile
@import models.masterTransaction.AssetFile
@import models.master.Negotiation
@import models.masterTransaction.DocusignEnvelope
@(traderID: String,negotiation: Negotiation, assetFileList: Seq[AssetFile], negotiationFileList: Seq[NegotiationFile],docusignEnvelopeList: Seq[DocusignEnvelope])(implicit requestHeader: RequestHeader, messagesProvider: MessagesProvider, loginState: LoginState = null)

@negotiation.status match {

    case constants.Status.Negotiation.BUYER_ACCEPTED_ALL_NEGOTIATION_TERMS => {
        @negotiationFileList.find(_.documentType == constants.File.Negotiation.CONTRACT) match {
            case Some(document) => {
                <div>
                    <a onclick="switchTab('@constants.View.VIEW_DOCUMENTS', '1', jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocument('@negotiation.id', '@document.documentType'))">@Messages(constants.File.Negotiation.CONTRACT)</a>
                    <td class="seenIcon"><img src="@routes.Assets.versioned("./images/icons/seenIcon.svg")" onclick="getForm(jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocumentContent('@negotiation.id', '@document.documentType'))")></td>
                    @docusignEnvelopeList.find(_.documentType == constants.File.Negotiation.CONTRACT) match {
                        case Some(docusignEnvelope) => {
                            @if(docusignEnvelope.status == constants.Status.DocuSignEnvelopeStatus.CREATED && negotiation.sellerTraderID == traderID) {
                                @commonModalButton(constants.View.SEND_FOR_SIGNATURE, routes.javascript.DocusignController.send, 'parameters -> s"'${negotiation.id}','${constants.File.Negotiation.CONTRACT}'")
                            }
                            @if(docusignEnvelope.status == constants.Status.DocuSignEnvelopeStatus.SENT && negotiation.buyerTraderID == traderID) {
                                @commonModalButton(constants.View.E_SIGN, routes.javascript.DocusignController.sign, 'parameters -> s"'${negotiation.id}','${constants.File.Negotiation.CONTRACT}'")
                            }
                            @if(docusignEnvelope.status == constants.Status.DocuSignEnvelopeStatus.COMPLETED) {
                                <span>@constants.View.SIGNED</span>
                            }
                        }
                        case None => {
                            @if(negotiation.sellerTraderID == traderID) {
                                @commonModalButton(constants.View.SEND_FOR_SIGNATURE, routes.javascript.DocusignController.send, 'parameters -> s"'${negotiation.id}','${constants.File.Negotiation.CONTRACT}'")
                                @commonFormButton(constants.Form.MARK_CONTRACT_SIGNED,'parameters -> s"'${negotiation.id}'")
                            }

                        }
                    }
                </div>
            }
            case None => {}

        }
    }
    case constants.Status.Negotiation.CONTRACT_SIGNED | constants.Status.Negotiation.BUYER_CONFIRMED_SELLER_PENDING | constants.Status.Negotiation.SELLER_CONFIRMED_BUYER_PENDING | constants.Status.Negotiation.BOTH_PARTIES_CONFIRMED=> {

        @Messages(constants.View.ASSET_DOCUMENTS):
        @assetFileList.filter(assetFile => negotiation.documentList.assetDocuments.contains(assetFile.documentType)).map { assetFile =>
            <div>
                <a onclick="switchTab('@constants.View.VIEW_DOCUMENTS', '1', jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocument('@negotiation.id', '@assetFile.documentType'))">@Messages(assetFile.documentType)</a>
                @assetFile.documentType match {
                    case constants.File.Asset.BILL_OF_LADING => {
                        <td class="seenIcon"><img src="@routes.Assets.versioned("./images/icons/seenIcon.svg")" onclick="getForm(jsRoutes.controllers.ComponentViewController.traderViewAssetDocumentContent('@negotiation.assetID', '@assetFile.documentType'))")></td>
                    }
                    case _=> {}
                }
            </div>
        }

        @Messages(constants.View.NEGOTIATION_DOCUMENTS):
        @negotiationFileList.filter(negotiationFile => negotiation.documentList.negotiationDocuments.contains(negotiationFile.documentType) || negotiationFile.documentType == constants.File.Negotiation.CONTRACT).map { negotiationFile =>
            <div>
                <a onclick="switchTab('@constants.View.VIEW_DOCUMENTS', '1', jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocument('@negotiation.id', '@negotiationFile.documentType'))">@Messages(negotiationFile.documentType)</a>
                @negotiationFile.documentType match {
                    case constants.File.Negotiation.INVOICE => {
                        <td class="seenIcon"><img src="@routes.Assets.versioned("./images/icons/seenIcon.svg")" onclick="getForm(jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocumentContent('@negotiation.id', '@negotiationFile.documentType'))")></td>
                    }
                    case constants.File.Negotiation.CONTRACT => {
                        <td class="seenIcon"><img src="@routes.Assets.versioned("./images/icons/seenIcon.svg")" onclick="getForm(jsRoutes.controllers.ComponentViewController.traderViewNegotiationDocumentContent('@negotiation.id', '@negotiationFile.documentType'))")></td>
                        <span>@constants.View.SIGNED</span>
                    }
                    case _ => {}
                }
            </div>
        }
    }
    case _ => {}
        }
        <script src="@routes.Assets.versioned("javascripts/switchTab.js")" type="text/javascript"></script>